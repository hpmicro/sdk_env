.. _qei:

QEI
======

概述
------

**QEI** 工程演示了如何使用正交编码器接口读取电机编码器数据并通过串口输出。

- 配置QEI中断和触发条件
- 读取QEI寄存器数据，包括Z、相位、速度和定时器值
- 使用TRGM（触发多路复用器）路由编码器信号

配置
------

- 安装串口终端，查看 :ref:`板子信息 <board_resource>` 并配置串口参数

- 本程序使用雷赛智能的 **BLM57050-1000** 无刷电机，具体参数请参考`雷赛智能官网 <https://leisai.com/>`_。

- 点击查看 :ref:`DRV-LV50A-MP1907电机驱动板 <drv_lv50a_mp1907>` 章节进行配置

- QEI配置说明：
  - 根据电机规格设置每转相位计数
  - 在相位计数最大值时增加Z计数
  - 设置相位比较触发点，用于在特定电机位置捕获数据
  - 使用正比较标志触发数据捕获

运行现象
------------

- 上电后，打开串口终端
- 程序将初始化QEI和TRGM
- 当转动电机轴时，将触发QEI中断并打印以下数据：
  - Z计数：编码器Z信号计数
  - 相位：当前相位位置
  - 速度：4个连续速度历史样本点(his0到his3)的累加值
  - 定时器：捕获时的定时器值

.. code-block:: console

   > z: 0xffffff9c
   > phase: 0xc200014d
   > speed: 0xa0000000
   > timer: 0xa8d08799

这些值会随着以下因素变化：
- 电机转速
- 转动方向
- 编码器分辨率
- 相位计数配置

